<div id='mydiv' style='display:none'>
    TEST
</div>
<p>
    <%= @game.name %>
</p>
<div class="chessboard">
    <% (1..8).each do |y| %>
    <% (1..8).each do |x| %>
    <%  piece = @game.pieces.where("(x_position = ? AND y_position = ?)", x,y).first %>
    <% if piece.nil? %>
    <div class="droppable <%= @game.tile_color(x,y)%>" data-x_coord=<%=x %> data-y_coord =
        <%= y %>></div>
    <% else %>
    <div class="droppable <%= @game.tile_color(x,y)%>" data-x_coord=<%=x %> data-y_coord =
        <%= y %>>
        <div class="piece " data-piece-id="<%= piece.id %>" data-x_coord=<%=x %> data-y_coord=
            <%= y %>>
            <%=  piece.html_code.html_safe %>
        </div>
    </div>
    <% end %>
    <% end %>
    <% end %>
</div>
<br />
<script>
$(document).ready(function() {
    let getGameData = async () => {
        let id = $('.piece').attr('data-piece-id');
        $.getJSON(id).success((data) => {
            parseState(data);
        });
    };
    let updatePieceData = () => {
        let data = {
            piece: {
                id: data - piece - id,
                x_coord: data - x_coord,
                y_coord: data - y_coord
            }
        }
        let id = $('.piece').attr('data-piece-id');
        $.ajax({
            url: '/pieces/' + id,
            type: 'PUT',
            data: data,
            dataType: 'json',
            success: function(result) {
                alert("posted");
            }
        });
    }

    getGameData();

    $('.piece').draggable({
        revert: "invalid"
    });
    $('.droppable').droppable({
        drop: (e, ui) => {
            e.target.innerHTML = `<div class="piece">${ui.draggable.html()}</div>`;
            ui.draggable.remove();
            $('.piece').draggable({
                revert: "invalid"
            });
            updatePieceData();
        }
    })
});
</script>
<%
=begin %>
let id = $('.chessboard').attr('id');
$.ajax({
url: '/pieces/' + ui.draggable.attr('id'),
type: 'PUT',
data: {
piece: {
x_coord: $(this).data(x),
y_coord: $(this).data(y)
},
}
dataType: 'json',
success: function(result) {
alert("posted");
}
});
<%
    =end %>
</script>
<%
=begin%>
<div class="chessboard">
    <table>
        <tbody>
            <% (1..8).each do |y_position| %>
            <tr id=<%=y_position %>>
                <% (1..8).each do |x_position| %>
                <td data-x-coord=<%=x_position %>
                    data-y-coord=
                    <%= y_position %> class='tile
                    <%= "#{
                      (y_position % 2 == x_position % 2 ? "white" : "black")}" %>'>
                    <% if piece = @game.pieces.where("(x_position = ? AND y_position = ?)", x_position,y_position).first %>
                    <span>
                        <%=  piece.html_code.html_safe %>
                    </span>
                    <% end %>
                </td>
                <% end %>
            </tr>
            <% end %>
        </tbody>
    </table>
</div>
<%
=end %>